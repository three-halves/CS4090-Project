@namespace UI
@rendermode InteractiveServer

<style>

.Disabled {
    background-color: black;
}

div {
    width: 100%;
    height: 100%;
    outline: 1px solid black
}

</style>

<div class=@_currentState.ToString() 
    @onmousedown="ToggleAvailability" 
    @onmouseenter="MouseEnterHandler"
    draggable="false"
    style="background-color: color-mix(in lab,
        darkgrey,
        green calc(@(_currentState == State.Available ? _selectedRatio : _ratio) * 100%)
        "> 
</div>

@code{
    [Parameter]
    public EventCallback<MouseEventArgs> OnMouseEnter { get; set; }

    [Parameter]
    public int MaxAttendeeCount { get; set; }

    [Parameter]
    public int AttendeeCount {get; set; }

    protected override async Task OnInitializedAsync()
    {
        _ratio = ((float)AttendeeCount) / MaxAttendeeCount;
        _selectedRatio = ((float)AttendeeCount + 1) / MaxAttendeeCount;
        await InvokeAsync(StateHasChanged);
    }

    private float _ratio = 0.5f;
    private float _selectedRatio = 0.5f;


    public enum State 
    {
        Available,
        Unavailable,
        Disabled
    }

    public State CurrentState {
        get {return _currentState;} 
        set
        {
            if (_currentState != State.Disabled)
                _currentState = value;
        }
    }
    private State _currentState = State.Unavailable;

    public async void MouseEnterHandler(MouseEventArgs args)
    {
        await OnMouseEnter.InvokeAsync(args);
    }

    public void ToggleAvailability() 
    {
        switch (_currentState) 
        {
            case State.Available: _currentState = State.Unavailable; break; 
            case State.Unavailable: _currentState = State.Available; break;
            default: return;
        }
        InvokeAsync(StateHasChanged);
    }
}